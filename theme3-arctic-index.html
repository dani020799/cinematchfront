<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cinematch - Your Movie Recommendation Platform</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; }
        /* Ensure content doesn't get hidden under fixed header */
        .content-wrapper { padding-top: 4rem; }
        /* Hide scrollbars while keeping scroll functionality */
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-gradient-to-br from-teal-600 via-cyan-500 to-gray-600 min-h-screen text-white">
    <!-- Header placeholder -->
    <div id="header-placeholder"></div>

    <!-- Main content -->
    <div class="content-wrapper">
        <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="mb-8">
                <h2 class="text-4xl font-bold text-white tracking-tight drop-shadow-lg bg-gradient-to-r from-cyan-200 to-teal-200 bg-clip-text text-transparent">Welcome to Cinematch</h2>
                <p class="text-cyan-100 mt-3 text-lg drop-shadow-md">Your personalized movie and TV show recommendation platform.</p>
            </div>

            <!-- 1) Trending Now -->
            <section class="bg-white/10 backdrop-blur-2xl rounded-3xl shadow-2xl border border-white/20 p-8 mb-8 hover:bg-white/15 transition-all duration-300">
                <h3 class="text-2xl font-bold text-white mb-4 drop-shadow-md bg-gradient-to-r from-cyan-300 to-teal-300 bg-clip-text text-transparent">Trending Now</h3>
                <div class="overflow-x-auto overflow-y-hidden snap-x snap-mandatory scroll-smooth touch-pan-x cursor-grab" data-hscroll>
                    <div id="trending-row" class="flex flex-nowrap gap-x-6 pb-3 min-w-max"></div>
                </div>
            </section>

            <!-- 2) Top Rated with toggle -->
            <section class="bg-white/10 backdrop-blur-2xl rounded-3xl shadow-2xl border border-white/20 p-8 mb-8 hover:bg-white/15 transition-all duration-300">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-2xl font-bold text-white drop-shadow-md bg-gradient-to-r from-cyan-300 to-teal-300 bg-clip-text text-transparent">Top Rated</h3>
                    <div class="inline-flex rounded-2xl border border-cyan-400/50 overflow-hidden bg-white/10 backdrop-blur-xl" role="group" aria-label="Top Rated Toggle">
                        <button id="btn-top-movies" type="button" class="px-4 py-2 text-sm font-semibold bg-gradient-to-r from-cyan-500 to-teal-500 text-white focus:outline-none focus:ring-2 focus:ring-cyan-300 transition-all duration-200">Movies</button>
                        <button id="btn-top-tv" type="button" class="px-4 py-2 text-sm font-semibold bg-transparent text-white hover:bg-white/20 focus:outline-none transition-all duration-200">TV Shows</button>
                    </div>
                </div>
                <div class="overflow-x-auto overflow-y-hidden snap-x snap-mandatory scroll-smooth touch-pan-x cursor-grab" data-hscroll>
                    <div id="top-rated-row" class="flex flex-nowrap gap-x-6 pb-3 min-w-max"></div>
                </div>
            </section>

            <!-- 3) Now Playing -->
            <section class="bg-white/10 backdrop-blur-2xl rounded-3xl shadow-2xl border border-white/20 p-8 hover:bg-white/15 transition-all duration-300">
                <h3 class="text-2xl font-bold text-white mb-4 drop-shadow-md bg-gradient-to-r from-cyan-300 to-teal-300 bg-clip-text text-transparent">Now Playing</h3>
                <div class="overflow-x-auto overflow-y-hidden snap-x snap-mandatory scroll-smooth touch-pan-x cursor-grab" data-hscroll>
                    <div id="now-playing-row" class="flex flex-nowrap gap-x-6 pb-3 min-w-max"></div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Provide header interactions for dynamically-inserted header.html
        function initHeaderInteractions() {
            const userDropdown = document.querySelector('.user-dropdown');
            if (!userDropdown) return;

            if (typeof window.toggleUserDropdown !== 'function') {
                window.toggleUserDropdown = function () {
                    const isActive = userDropdown.classList.contains('active');
                    if (isActive) {
                        userDropdown.classList.remove('active');
                        document.body.classList.remove('dropdown-open');
                    } else {
                        userDropdown.classList.add('active');
                        document.body.classList.add('dropdown-open');
                    }
                };
            }

            if (!window.__headerDropdownBound) {
                document.addEventListener('click', function (event) {
                    if (!userDropdown.contains(event.target)) {
                        userDropdown.classList.remove('active');
                        document.body.classList.remove('dropdown-open');
                    }
                });

                document.addEventListener('keydown', function (event) {
                    if (event.key === 'Escape') {
                        userDropdown.classList.remove('active');
                        document.body.classList.remove('dropdown-open');
                    }
                });

                window.__headerDropdownBound = true;
            }

            const userButton = userDropdown.querySelector('.user-button');
            if (userButton) {
                userButton.setAttribute('onclick', 'toggleUserDropdown()');
            }
        }

        // Load header.html
        fetch('theme3-arctic-header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-placeholder').innerHTML = data;
                initHeaderInteractions();
            })
            .catch(error => console.error('Error loading header:', error));

        // Enhanced horizontal scroll functionality
        function enhanceHorizontalScroll() {
            const scrollContainers = document.querySelectorAll('[data-hscroll]');

            scrollContainers.forEach(container => {
                let isDown = false;
                let startX;
                let scrollLeft;

                // Mouse events
                container.addEventListener('mousedown', (e) => {
                    isDown = true;
                    container.style.cursor = 'grabbing';
                    startX = e.pageX - container.offsetLeft;
                    scrollLeft = container.scrollLeft;
                });

                container.addEventListener('mouseleave', () => {
                    isDown = false;
                    container.style.cursor = 'grab';
                });

                container.addEventListener('mouseup', () => {
                    isDown = false;
                    container.style.cursor = 'grab';
                });

                container.addEventListener('mousemove', (e) => {
                    if (!isDown) return;
                    e.preventDefault();
                    const x = e.pageX - container.offsetLeft;
                    const walk = (x - startX) * 2;
                    container.scrollLeft = scrollLeft - walk;
                });

                // Wheel scroll
                container.addEventListener('wheel', (e) => {
                    if (e.deltaY !== 0) {
                        e.preventDefault();
                        container.scrollLeft += e.deltaY;
                    }
                });

                // Keyboard navigation
                container.addEventListener('keydown', (e) => {
                    if (e.key === 'ArrowLeft') {
                        e.preventDefault();
                        container.scrollLeft -= 200;
                    } else if (e.key === 'ArrowRight') {
                        e.preventDefault();
                        container.scrollLeft += 200;
                    }
                });

                container.setAttribute('tabindex', '0');
            });
        }

        // Initialize top-rated toggle functionality
        function initTopRatedToggle() {
            const movieBtn = document.getElementById('btn-top-movies');
            const tvBtn = document.getElementById('btn-top-tv');

            if (!movieBtn || !tvBtn) return;

            function setToggleActive(activeBtn, inactiveBtn) {
                activeBtn.classList.remove('bg-transparent', 'text-white', 'hover:bg-white/20');
                activeBtn.classList.add('bg-gradient-to-r', 'from-cyan-500', 'to-teal-500', 'text-white');
                
                inactiveBtn.classList.remove('bg-gradient-to-r', 'from-cyan-500', 'to-teal-500', 'text-white');
                inactiveBtn.classList.add('bg-transparent', 'text-white', 'hover:bg-white/20');
            }

            movieBtn.addEventListener('click', () => {
                setToggleActive(movieBtn, tvBtn);
                loadTopRated('movie');
            });

            tvBtn.addEventListener('click', () => {
                setToggleActive(tvBtn, movieBtn);
                loadTopRated('tv');
            });
        }

        // Create card element
        function createCardElement(item, type) {
            const card = document.createElement('div');
            card.className = 'flex-none w-48 bg-white/15 backdrop-blur-xl rounded-2xl overflow-hidden shadow-2xl hover:shadow-cyan-500/25 transform hover:scale-105 transition-all duration-300 border border-white/30';
            
            const posterPath = item.poster_path 
                ? `https://image.tmdb.org/t/p/w300${item.poster_path}`
                : 'https://via.placeholder.com/300x450/374151/9CA3AF?text=No+Image';
            
            const title = item.title || item.name || 'Unknown Title';
            const year = item.release_date || item.first_air_date 
                ? new Date(item.release_date || item.first_air_date).getFullYear()
                : 'N/A';
            const rating = item.vote_average ? item.vote_average.toFixed(1) : 'N/A';
            
            card.innerHTML = `
                <div class="relative">
                    <img src="${posterPath}" alt="${title}" class="w-full h-72 object-cover" loading="lazy">
                    <div class="absolute top-2 right-2 bg-gradient-to-r from-cyan-600 to-teal-600 backdrop-blur-sm text-white text-xs px-2 py-1 rounded-full font-semibold">
                        ‚≠ê ${rating}
                    </div>
                    <div class="absolute inset-0 bg-gradient-to-t from-teal-900/60 via-transparent to-transparent"></div>
                </div>
                <div class="p-4">
                    <h4 class="font-semibold text-white text-sm mb-1 line-clamp-2 leading-tight">${title}</h4>
                    <p class="text-cyan-200 text-xs">${year}</p>
                </div>
            `;
            
            return card;
        }

        // API functions remain the same...
        const API_KEY = '4e44d9029b1270a757cddc766a1bcb63';
        const BASE_URL = 'https://api.themoviedb.org/3';

        async function fetchMovies(endpoint) {
            try {
                const response = await fetch(`${BASE_URL}${endpoint}?api_key=${API_KEY}`);
                const data = await response.json();
                return data.results || [];
            } catch (error) {
                console.error('Error fetching movies:', error);
                return [];
            }
        }

        async function loadTrending() {
            const movies = await fetchMovies('/trending/movie/week');
            const container = document.getElementById('trending-row');
            container.innerHTML = '';
            
            movies.slice(0, 10).forEach(movie => {
                const card = createCardElement(movie, 'movie');
                container.appendChild(card);
            });
        }

        async function loadTopRated(type = 'movie') {
            const endpoint = type === 'movie' ? '/movie/top_rated' : '/tv/top_rated';
            const items = await fetchMovies(endpoint);
            const container = document.getElementById('top-rated-row');
            container.innerHTML = '';
            
            items.slice(0, 10).forEach(item => {
                const card = createCardElement(item, type);
                container.appendChild(card);
            });
        }

        async function loadNowPlaying() {
            const movies = await fetchMovies('/movie/now_playing');
            const container = document.getElementById('now-playing-row');
            container.innerHTML = '';
            
            movies.slice(0, 10).forEach(movie => {
                const card = createCardElement(movie, 'movie');
                container.appendChild(card);
            });
        }

        // Initialize everything
        document.addEventListener('DOMContentLoaded', () => {
            enhanceHorizontalScroll();
            initTopRatedToggle();
            loadTrending();
            loadTopRated('movie');
            loadNowPlaying();
        });
    </script>
</body>
</html>