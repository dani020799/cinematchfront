<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cinematch - Your Movie Recommendation Platform</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; }
        /* Ensure content doesn't get hidden under fixed header */
        .content-wrapper { padding-top: 4rem; }
        /* Hide scrollbars while keeping scroll functionality */
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        
        /* Aspect ratio utilities for video container */
        .aspect-w-16 { position: relative; padding-bottom: 56.25%; /* 16:9 aspect ratio */ }
        .aspect-w-16 > * { position: absolute; height: 100%; width: 100%; top: 0; right: 0; bottom: 0; left: 0; }
        
        /* Cinematic video section enhancements */
        #cinematic-video {
            background: linear-gradient(135deg, rgba(251, 146, 60, 0.4) 0%, rgba(239, 68, 68, 0.3) 50%, rgba(147, 51, 234, 0.4) 100%);
        }
        
        /* Curved transition SVG */
        .curved-transition {
            fill: linear-gradient(135deg, #fb923c, #ef4444, #3b82f6);
        }
        
        /* Floating button animations */
        @keyframes float {
            0%, 100% { transform: translateX(-50%) translateY(0px); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }
        
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-orange-400 via-red-500 to-blue-900 min-h-screen text-white">
    <!-- Header placeholder -->
    <div id="header-placeholder"></div>

    <!-- Main content -->
    <div class="content-wrapper">
        <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="mb-6">
                <h2 class="text-4xl font-bold text-white tracking-tight drop-shadow-lg bg-gradient-to-r from-orange-200 to-yellow-200 bg-clip-text text-transparent">Welcome to Cinematch</h2>
                <p class="text-orange-100 mt-3 text-lg drop-shadow-md">Your personalized movie and TV show recommendation platform.</p>
            </div>

            <!-- Cinematic Top Video Section -->
            <section id="cinematic-video" class="relative overflow-hidden mb-16 transition-all duration-700 ease-in-out transform">
                <!-- Gradient Background with Curved Bottom -->
                <div class="bg-gradient-to-br from-orange-300/40 via-red-400/30 to-purple-600/40 backdrop-blur-xl relative">
                    <!-- Close Button -->
                    <button id="close-video-btn" class="absolute top-6 right-6 w-10 h-10 bg-black/50 backdrop-blur-md rounded-full border border-white/40 text-white hover:bg-black/70 hover:scale-110 transition-all duration-300 flex items-center justify-center text-lg font-bold z-20 shadow-2xl">
                        ✕
                    </button>
                    
                    <!-- Video Container with Padding -->
                    <div class="px-6 sm:px-8 lg:px-12 pt-8 pb-16">
                        <!-- Video Title Above -->
                        <div class="text-center mb-6">
                            <h2 class="text-3xl sm:text-4xl font-bold text-white drop-shadow-2xl bg-gradient-to-r from-orange-200 via-yellow-200 to-pink-200 bg-clip-text text-transparent mb-2">Featured Cinematic Experience</h2>
                            <p class="text-orange-100/90 text-lg drop-shadow-md">Immerse yourself in the latest blockbuster</p>
                        </div>
                        
                        <!-- Video Frame with Glass Effect -->
                        <div class="max-w-5xl mx-auto">
                            <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-4 shadow-2xl border border-white/20">
                                <div class="aspect-w-16 aspect-h-9 rounded-2xl overflow-hidden shadow-inner">
                                    <iframe 
                                        src="https://www.youtube.com/embed/dQw4w9WgXcQ?si=example" 
                                        title="Featured Movie Trailer" 
                                        frameborder="0" 
                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                                        allowfullscreen
                                        class="w-full h-full rounded-2xl">
                                    </iframe>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Curved Bottom Transition -->
                    <div class="absolute bottom-0 left-0 right-0 h-16">
                        <svg class="absolute bottom-0 w-full h-16" viewBox="0 0 1200 120" preserveAspectRatio="none">
                            <defs>
                                <linearGradient id="curveGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:#fb923c;stop-opacity:1" />
                                    <stop offset="50%" style="stop-color:#ef4444;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#3b82f6;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <path d="M0,0 C300,120 900,120 1200,0 L1200,120 L0,120 Z" fill="url(#curveGradient)"></path>
                        </svg>
                    </div>
                </div>
            </section>
            
            <!-- Floating Reopen Button (Hidden by default) -->
            <div id="reopen-video-btn" class="fixed top-20 left-1/2 transform -translate-x-1/2 z-30 hidden animate-float">
                <button class="w-12 h-12 bg-gradient-to-r from-orange-500 to-red-500 backdrop-blur-md rounded-full border-2 border-white/30 text-white hover:scale-110 hover:shadow-2xl transition-all duration-300 flex items-center justify-center text-xl shadow-lg">
                    ↓
                </button>
            </div>

            <!-- 1) Trending Now -->
            <section class="bg-white/20 backdrop-blur-xl rounded-2xl shadow-2xl border border-white/30 p-8 mb-8 hover:bg-white/25 transition-all duration-300">
                <h3 class="text-2xl font-bold text-white mb-4 drop-shadow-md bg-gradient-to-r from-orange-300 to-yellow-300 bg-clip-text text-transparent">Trending Now</h3>
                <div class="overflow-x-auto overflow-y-hidden snap-x snap-mandatory scroll-smooth touch-pan-x cursor-grab" data-hscroll>
                    <div id="trending-row" class="flex flex-nowrap gap-x-4 pb-2 min-w-max"></div>
                </div>
            </section>

            <!-- 2) Top Rated with toggle -->
            <section class="bg-white/20 backdrop-blur-xl rounded-2xl shadow-2xl border border-white/30 p-8 mb-8 hover:bg-white/25 transition-all duration-300">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-2xl font-bold text-white drop-shadow-md bg-gradient-to-r from-orange-300 to-yellow-300 bg-clip-text text-transparent">Top Rated</h3>
                    <div class="inline-flex rounded-xl border border-white/40 overflow-hidden bg-black/30 backdrop-blur-md" role="group" aria-label="Top Rated Toggle">
                        <button id="btn-top-movies" type="button" class="px-4 py-2 text-sm font-semibold bg-orange-500 text-white focus:outline-none focus:ring-2 focus:ring-orange-300 transition-all duration-200">Movies</button>
                        <button id="btn-top-tv" type="button" class="px-4 py-2 text-sm font-semibold bg-transparent text-white hover:bg-white/20 focus:outline-none transition-all duration-200">TV Shows</button>
                    </div>
                </div>
                <div class="overflow-x-auto overflow-y-hidden snap-x snap-mandatory scroll-smooth touch-pan-x cursor-grab" data-hscroll>
                    <div id="top-rated-row" class="flex flex-nowrap gap-x-6 pb-3 min-w-max"></div>
                </div>
            </section>

            <!-- 3) Now Playing -->
            <section class="bg-white/20 backdrop-blur-xl rounded-2xl shadow-2xl border border-white/30 p-8 mb-8 hover:bg-white/25 transition-all duration-300">
                <h3 class="text-2xl font-bold text-white mb-4 drop-shadow-md bg-gradient-to-r from-orange-300 to-yellow-300 bg-clip-text text-transparent">Now Playing</h3>
                <div class="overflow-x-auto overflow-y-hidden snap-x snap-mandatory scroll-smooth touch-pan-x cursor-grab" data-hscroll>
                    <div id="now-playing-row" class="flex flex-nowrap gap-x-6 pb-3 min-w-max"></div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Provide header interactions for dynamically-inserted header.html
        function initHeaderInteractions() {
            const userDropdown = document.querySelector('.user-dropdown');
            if (!userDropdown) return;

            if (typeof window.toggleUserDropdown !== 'function') {
                window.toggleUserDropdown = function () {
                    const isActive = userDropdown.classList.contains('active');
                    if (isActive) {
                        userDropdown.classList.remove('active');
                        document.body.classList.remove('dropdown-open');
                    } else {
                        userDropdown.classList.add('active');
                        document.body.classList.add('dropdown-open');
                    }
                };
            }

            if (!window.__headerDropdownBound) {
                document.addEventListener('click', function (event) {
                    if (!userDropdown.contains(event.target)) {
                        userDropdown.classList.remove('active');
                        document.body.classList.remove('dropdown-open');
                    }
                });

                document.addEventListener('keydown', function (event) {
                    if (event.key === 'Escape') {
                        userDropdown.classList.remove('active');
                        document.body.classList.remove('dropdown-open');
                    }
                });

                window.__headerDropdownBound = true;
            }

            const userButton = userDropdown.querySelector('.user-button');
            if (userButton) {
                userButton.setAttribute('aria-expanded', 'false');
                userButton.setAttribute('aria-haspopup', 'true');

                const observer = new MutationObserver(function (mutations) {
                    mutations.forEach(function (mutation) {
                        if (mutation.attributeName === 'class') {
                            const isActive = userDropdown.classList.contains('active');
                            userButton.setAttribute('aria-expanded', String(isActive));
                        }
                    });
                });

                observer.observe(userDropdown, { attributes: true, attributeFilter: ['class'] });
            }
        }

        async function loadHeader() {
            try {
                const cacheBuster = `v=${Date.now()}`;
                const response = await fetch(`header.html?${cacheBuster}`, { cache: 'no-store' });
                if (!response.ok) throw new Error(`Failed to load header: ${response.status} ${response.statusText}`);
                const headerContent = await response.text();
                document.getElementById('header-placeholder').innerHTML = headerContent;
                initHeaderInteractions();
            } catch (error) {
                console.error('Error loading header:', error);
                document.getElementById('header-placeholder').innerHTML = '<div class="bg-red-100 text-red-700 p-4">Failed to load header. Please hard refresh (Ctrl+F5) and try again.</div>';
            }
        }

        // ===== Media card rendering =====
        let __mediaCardHTML = null;
        async function getMediaCardHTML() {
            if (__mediaCardHTML) return __mediaCardHTML;
            const cacheBuster = `v=${Date.now()}`;
            const res = await fetch(`media-card.html?${cacheBuster}`, { cache: 'no-store' });
            if (!res.ok) throw new Error(`Failed to load media-card.html: ${res.status}`);
            __mediaCardHTML = await res.text();
            return __mediaCardHTML;
        }

        function createCardElement(cardHTML) {
            const t = document.createElement('template');
            t.innerHTML = cardHTML.trim();
            const card = t.content.firstElementChild;
            if (card) {
                // Make compact & responsive; ignore template sizing
                card.classList.remove('w-full', 'max-w-[12rem]');
                card.classList.add('flex-none', 'w-[160px]', 'sm:w-[176px]', 'md:w-[192px]', 'snap-start');
                // Use the template's real image; add graceful fallback only if it fails
                const img = card.querySelector('img');
                if (img) {
                    img.referrerPolicy = 'no-referrer';
                    img.addEventListener('error', () => {
                        img.src = 'https://placehold.co/400x600?text=Image';
                    }, { once: true });
                }
            }
            return card;
        }

        async function renderCards(containerId, count = 20) {
            const container = document.getElementById(containerId);
            if (!container) return;
            container.innerHTML = '';
            const cardHTML = await getMediaCardHTML();
            for (let i = 0; i < count; i++) {
                const card = createCardElement(cardHTML);
                if (card) container.appendChild(card);
            }
        }

        // ===== Top Rated toggle =====
        function setToggleActive(buttonEl, active) {
            const activeClasses = ['bg-indigo-600', 'text-white'];
            const inactiveClasses = ['bg-transparent', 'text-gray-700'];
            if (active) {
                buttonEl.classList.add(...activeClasses);
                buttonEl.classList.remove(...inactiveClasses);
            } else {
                buttonEl.classList.remove(...activeClasses);
                buttonEl.classList.add(...inactiveClasses);
            }
        }

        function initTopRatedToggle() {
            const btnMovies = document.getElementById('btn-top-movies');
            const btnTV = document.getElementById('btn-top-tv');
            if (!btnMovies || !btnTV) return;

            // Default state
            setToggleActive(btnMovies, true);
            setToggleActive(btnTV, false);

            btnMovies.addEventListener('click', async () => {
                setToggleActive(btnMovies, true);
                setToggleActive(btnTV, false);
                await renderCards('top-rated-row', 20);
            });

            btnTV.addEventListener('click', async () => {
                setToggleActive(btnMovies, false);
                setToggleActive(btnTV, true);
                await renderCards('top-rated-row', 20);
            });
        }

        // Cinematic Video Toggle Functionality
        function initCinematicVideo() {
            const closeVideoBtn = document.getElementById('close-video-btn');
            const reopenVideoBtn = document.getElementById('reopen-video-btn');
            const cinematicVideo = document.getElementById('cinematic-video');
            
            // Close video function
            function closeVideo() {
                if (cinematicVideo) {
                    cinematicVideo.style.transform = 'translateY(-100%)';
                    cinematicVideo.style.opacity = '0';
                    
                    setTimeout(() => {
                        cinematicVideo.style.display = 'none';
                        if (reopenVideoBtn) {
                            reopenVideoBtn.classList.remove('hidden');
                            setTimeout(() => {
                                reopenVideoBtn.style.opacity = '1';
                                reopenVideoBtn.style.transform = 'translateX(-50%) scale(1)';
                            }, 100);
                        }
                    }, 700);
                }
            }
            
            // Reopen video function
            function reopenVideo() {
                if (cinematicVideo && reopenVideoBtn) {
                    reopenVideoBtn.style.opacity = '0';
                    reopenVideoBtn.style.transform = 'translateX(-50%) scale(0.8)';
                    
                    setTimeout(() => {
                        reopenVideoBtn.classList.add('hidden');
                        cinematicVideo.style.display = 'block';
                        
                        setTimeout(() => {
                            cinematicVideo.style.transform = 'translateY(0)';
                            cinematicVideo.style.opacity = '1';
                        }, 50);
                    }, 300);
                }
            }
            
            // Event listeners
            if (closeVideoBtn) {
                closeVideoBtn.addEventListener('click', closeVideo);
            }
            
            if (reopenVideoBtn) {
                reopenVideoBtn.addEventListener('click', reopenVideo);
                // Initialize reopen button styles
                reopenVideoBtn.style.opacity = '0';
                reopenVideoBtn.style.transform = 'translateX(-50%) scale(0.8)';
                reopenVideoBtn.style.transition = 'all 0.3s ease';
            }
            
            // Initialize cinematic video styles
            if (cinematicVideo) {
                cinematicVideo.style.transition = 'all 0.7s cubic-bezier(0.4, 0, 0.2, 1)';
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', async function () {
            loadHeader();
            // initial renders
            await Promise.all([
                renderCards('trending-row', 20),
                renderCards('top-rated-row', 20),
                renderCards('now-playing-row', 20)
            ]);
            initTopRatedToggle();
            enhanceHorizontalScroll();
            initCinematicVideo();
        });
    </script>
</body>
</html>

<script>
function enhanceHorizontalScroll() {
    document.querySelectorAll('[data-hscroll]').forEach((el) => {
        if (!el.hasAttribute('tabindex')) el.setAttribute('tabindex', '0');

        // Force horizontal-only scrolling inside the container
        el.addEventListener(
            'wheel',
            (e) => {
                if (e.deltaY !== 0) {
                    el.scrollLeft += e.deltaY; // map vertical to horizontal
                    e.preventDefault();
                    return;
                }
                if (e.deltaX !== 0) {
                    el.scrollLeft += e.deltaX;
                    e.preventDefault();
                }
            },
            { passive: false }
        );

        // Keyboard arrows
        el.addEventListener('keydown', (e) => {
            const step = Math.max(160, Math.floor(el.clientWidth * 0.9));
            if (e.key === 'ArrowRight') {
                el.scrollBy({ left: step, behavior: 'smooth' });
                e.preventDefault();
            } else if (e.key === 'ArrowLeft') {
                el.scrollBy({ left: -step, behavior: 'smooth' });
                e.preventDefault();
            }
        });

        // Drag-to-scroll (pointer events)
        let isDown = false;
        let startX = 0;
        let startScroll = 0;
        el.addEventListener('pointerdown', (e) => {
            isDown = true;
            startX = e.clientX;
            startScroll = el.scrollLeft;
            el.setPointerCapture(e.pointerId);
            el.classList.add('cursor-grabbing');
        });
        el.addEventListener('pointermove', (e) => {
            if (!isDown) return;
            const dx = e.clientX - startX;
            el.scrollLeft = startScroll - dx;
        });
        const stopDrag = () => {
            if (!isDown) return;
            isDown = false;
            el.classList.remove('cursor-grabbing');
        };
        el.addEventListener('pointerup', stopDrag);
        el.addEventListener('pointercancel', stopDrag);
        el.addEventListener('mouseleave', stopDrag);
    });
}
</script>
